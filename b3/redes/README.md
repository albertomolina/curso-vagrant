# Redes

Cuando utilizamos una máquina virtual, aunque no definamos ninguna red
en el fichero Vagrantfile, ya sabemos que en la inmensa mayoría de los
casos vagrant realiza los pasos necesarios para que esa máquina
virtual sea accesible a través de una red virtual desde el equipo
anfitrión y tenga acceso a Internet. Esta configuración lógicamente va
a variar en función del proveedor, pero en el caso de VirtualBox se
trata de una red de tipo NAT con el direccionamiento inicial
10.0.2.0/24.

## Red privada

En algunas ocasiones tendremos la necesidad de utilizar un
direccionamiento IP específico en una máquina virtual o añadir una red
virtual adicional, por lo que en muchos casos es adecuado añadir una
red privada, tal como se explica en
[Private Networks](https://www.vagrantup.com/docs/networking/private_network.html).

## Red pública

Para vagrant una red pública es una red en modo puente (*bridged
network*) conectada al exterior, típicamente sería poner en la misma
red la máquina anfitriona y la máquina virtual. Más detalles en
[Public Networks](https://www.vagrantup.com/docs/networking/public_network.html)

## Ejercicios

1. Configura un Vagrantfile en el que la máquina virtual tenga la
   dirección IP estática 192.168.33.10
   
   Editamos el fichero Vagrantfile y añadimos la línea:
   
   ```
   ...
   config.vm.network "private_network", ip: "192.168.33.10"
   ...
   ```
   Al acceder por ssh a la máquina (utilizando la red NAT como
   habitualmente) podemos ver que la máquina virtual tiene dos
   interfaces de red, una en la red NAT con dirección IP del rango
   10.0.2.0/24 y otra la dirección IP estática que hemos asignado:
   
   ```
   ip a
   1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default 
       link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
       inet 127.0.0.1/8 scope host lo
          valid_lft forever preferred_lft forever
      inet6 ::1/128 scope host 
         valid_lft forever preferred_lft forever
   2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
       link/ether 08:00:27:98:b7:7b brd ff:ff:ff:ff:ff:ff
       inet 10.0.2.15/24 brd 10.0.2.255 scope global eth0
          valid_lft forever preferred_lft forever
	   inet6 fe80::a00:27ff:fe98:b77b/64 scope link 
		  valid_lft forever preferred_lft forever
   3: eth1:
   <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
       link/ether 08:00:27:68:02:01 brd ff:ff:ff:ff:ff:ff
	   inet 192.168.33.10/24 brd 192.168.33.255 scope global eth1
	      valid_lft forever preferred_lft forever
	   inet6 fe80::a00:27ff:fe68:201/64 scope link 
		  valid_lft forever preferred_lft forever
   ```
   Y en la tabla de encaminamiento podemos ver que la máquina virtual
   sale a Internet por la red NAT:
   ```
   ip r
   default via 10.0.2.2 dev eth0 
   10.0.2.0/24 dev eth0  proto kernel  scope link  src 10.0.2.15 
   192.168.33.0/24 dev eth1  proto kernel  scope link  src 192.168.33.10 
   ```
   
   Podemos acceder a la máquina virtual utilizando la nueva red
   privada, ya que la máquina anfitriona también está conectada a esa
   red:
   
   ```
   ssh -i .vagrant/machines/default/virtualbox/private_key vagrant@192.168.33.10
   ```
1. Configura un entorno de vagrant para que la máquina virtual esté
   conectada en modo puente a la misma red que la máquina anfitriona.
   
   ```
   config.vm.network  "public_network", bridge: "eth0"
   ```
   Accedemos a la máquina y vemos las interfaces de red así como la
   configuración de /etc/network/interfaces:
   
   ```
   ...
   #VAGRANT-BEGIN
   # The contents below are automatically generated by Vagrant. Do not
   modify.
   auto eth1
   iface eth1 inet dhcp
       post-up route del default dev $IFACE || true
   #VAGRANT-END
   ```
   
	   
